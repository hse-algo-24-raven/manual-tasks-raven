# Задание №14
# Задача о коммивояжере (Генетический алгоритм).
# Вариант 3:

## Постановка задачи
Есть N городов, связанных дорогами. Расстояния между городами известны. Коммивояжер (бродячий торговец) должен выйти из первого города, посетить по одному разу в некотором порядке города 2,3..n и вернуться в первый город. В каком порядке следует посещать города, чтобы замкнутый путь коммивояжера имел кратчайшее расстояние?

Для условий 3 варианта задания 12:
1. Сгенерировать 2 особи (случайных решения) в виде перестановки номеров городов, которая всегда начинается с единицы.
2. Рассчитать фитнес-функцию для особей.
3. Закодировать их с применением альтернативной кодировки с пошаговыми комментариями.
4. Провести равномерное скрещивание особей с пошаговыми комментариями, получить два потомка.
5. Провести мутацию одного из потомков с пошаговыми комментариями.
6. Декодировать альтернативную кодировку потомков в натуральную кодировку с пошаговыми комментариями.
7. Рассчитать фитнес-функцию для потомков.

Матрица расстояний:

|       | **A** | **B** | **C** | **D** | **E** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** | **∞** |   5   |   9   |   9   |   9   |
| **B** |   8   | **∞** |  10   |   5   |  11   |
| **C** |   9   |   5   | **∞** |  10   |   7   |
| **D** |  12   |   5   |  13   | **∞** |  10   |
| **E** |  12   |   5   |   8   |   7   | **∞** |

Определим номер для каждой вершины:
- A - 1;
- B - 2;
- C - 3;
- D - 4;
- E - 5.

Новая матрица расстояний: 

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **1** | **∞** |   5   |   9   |   9   |   9   |
| **2** |   8   | **∞** |  10   |   5   |  11   |
| **3** |   9   |   5   | **∞** |  10   |   7   |
| **4** |  12   |   5   |  13   | **∞** |  10   |
| **5** |  12   |   5   |   8   |   7   | **∞** |

## Решение
### Генерация особей 

Сгенерируем 2 особи, путем перестановки номеров городов, которые всегда начинаются с единицы.

- $x_1$ = 13542

- $x_2$ = 14325

### Фитнес-функция

Рассчитаем для особей фитнес-функцию, которая в контексте задачи о коммивояжере представляет собой длину маршрута.

- $F(x_1)$ = 9 + 7 + 7 + 5 + 8 = 36

- $F(x_2)$ = 9 + 13 + 5 + 11 + 12 = 50

### Альтернативная кодировка
#### Особь 1

Натуральный код особи $x_1$: 13542

| $x_1$                            |   |   |   |   |   |
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 3 | 5 | 4 | 2 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |

Альтернативный код: 1

| $x_1$                            |   |   |   |   |  
|----------------------------------|---|---|---|---|
| натуральный код                  | 3 | 5 | 4 | 2 |
| возрастающая перестановка        | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 |

Альтернативный код: 12

| $x_1$                            |   |   |   |  
|----------------------------------|---|---|---|
| натуральный код                  | 5 | 4 | 2 |
| возрастающая перестановка        | 2 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 |

Альтернативный код: 123

| $x_1$                            |   |   |    
|----------------------------------|---|---|
| натуральный код                  | 4 | 2 |
| возрастающая перестановка        | 2 | 4 |
| номера возрастающей перестановки | 1 | 2 |

Альтернативный код: 1232

| $x_1$                            |   |  
|----------------------------------|---|
| натуральный код                  | 2 |
| возрастающая перестановка        | 2 |
| номера возрастающей перестановки | 1 |

Альтернативный код особи $x_1$: 12321

#### Особь 2

Натуральный код особи $x_2$: 14325

| $x_2$                            |   |   |   |   |   |
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 4 | 3 | 2 | 5 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |

Альтернативный код: 1

| $x_2$                            |   |   |   |   |  
|----------------------------------|---|---|---|---|
| натуральный код                  | 4 | 3 | 2 | 5 |
| возрастающая перестановка        | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 |

Альтернативный код: 13

| $x_2$                            |   |   |   |  
|----------------------------------|---|---|---|
| натуральный код                  | 3 | 2 | 5 |
| возрастающая перестановка        | 2 | 3 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 |

Альтернативный код: 132

| $x_2$                            |   |   |    
|----------------------------------|---|---|
| натуральный код                  | 2 | 5 |
| возрастающая перестановка        | 2 | 5 |
| номера возрастающей перестановки | 1 | 2 |

Альтернативный код: 1321

| $x_2$                            |   |  
|----------------------------------|---|
| натуральный код                  | 5 |
| возрастающая перестановка        | 5 |
| номера возрастающей перестановки | 1 |

Альтернативный код особи $x_2$: 13211

### Равномерное скрещивание

Для проведения равномерного скрещивания сгенерируем случайную строку $z$ из нулей и единиц. 
Сформируем особь $x_3$ и $x_4$ по принципу: если i-ая позиция $z$ равна 0, то в $x_3$ пойдет i-ая позиция из $x_2$, а в $x_4$ - i-ая позиция из $x_1$, и наоборот при $z_i$ равной 1.  

| $z$                              | 0 | 0 | 1 | 1 | 0 |
|----------------------------------|---|---|---|---|---|
| $x_1$                            | 1 | 2 | 3 | 2 | 1 |
| $x_2$                            | 1 | 3 | 2 | 1 | 1 |
| $x_3$                            | 1 | 3 | 3 | 2 | 1 |
| $x_4$                            | 1 | 2 | 2 | 1 | 1 |

### Мутация

Проведем мутацию $x_4$. Для того чтобы мутировать i-ый разряд кодировки, выберем случайное число из диапазона от 1 до $(n-i+1)$. Для второго разряда диапазон будет от 1 до 4.

 $x_4$ = 12211 -> 14211

### Восстановление натурального кода
#### Особь 3
Альтернативный код: 13321

| $x_3$                            |   |   |   |   |   |
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 3 | 3 | 2 | 1 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |

Натуральный код: 1

| $x_3$                            |   |   |   |   |
|----------------------------------|---|---|---|---|
| альтернативный код               | 3 | 3 | 2 | 1 |
| возрастающая перестановка        | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 |

Натуральный код: 14

| $x_3$                            |   |   |   | 
|----------------------------------|---|---|---|
| альтернативный код               | 2 | 2 | 1 |
| возрастающая перестановка        | 2 | 3 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 |

Натуральный код: 145

| $x_3$                            |   |   |
|----------------------------------|---|---|
| альтернативный код               | 2 | 1 |
| возрастающая перестановка        | 2 | 3 |
| номера возрастающей перестановки | 1 | 2 |

Натуральный код: 1453

| $x_3$                            |   | 
|----------------------------------|---|
| альтернативный код               | 1 |
| возрастающая перестановка        | 2 |
| номера возрастающей перестановки | 1 |

Натуральный код: 14532

#### Особь 4
Альтернативный код: 14211

| $x_4$                            |   |   |   |   |   |
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 4 | 2 | 1 | 1 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |

Натуральный код: 1

| $x_4$                            |   |   |   |   |
|----------------------------------|---|---|---|---|
| альтернативный код               | 4 | 2 | 1 | 1 |
| возрастающая перестановка        | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 |

Натуральный код: 15

| $x_4$                            |   |   |   | 
|----------------------------------|---|---|---|
| альтернативный код               | 2 | 1 | 1 |
| возрастающая перестановка        | 2 | 3 | 4 |
| номера возрастающей перестановки | 1 | 2 | 3 |

Натуральный код: 153

| $x_4$                            |   |   |
|----------------------------------|---|---|
| альтернативный код               | 1 | 1 |
| возрастающая перестановка        | 2 | 4 |
| номера возрастающей перестановки | 1 | 2 |

Натуральный код: 1532

| $x_4$                            |   | 
|----------------------------------|---|
| альтернативный код               | 1 |
| возрастающая перестановка        | 4 |
| номера возрастающей перестановки | 1 |

Натуральный код: 15324

### Фитнес-функция для потомков

Рассчитаем для особей $x_3$ и $x_4$ фитнес-функцию:

- $F(x_3)$ = 9 + 10 + 8 + 5 + 8 = 40

- $F(x_4)$ = 9 + 8 + 5 + 5 + 12 = 39