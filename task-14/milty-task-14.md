# Задание №14
---
### Задача о коммивояжере (Генетический алгоритм) / Транспортная задача (Максимальный поток минимальной стоимости).
 ---

## Постановка задачи
Есть N городов, связанных дорогами. Расстояния между городами известны. Коммивояжер (бродячий торговец) должен выйти из первого города, посетить по одному разу в некотором порядке города 2,3..n и вернуться в первый город. В каком порядке следует посещать города, чтобы замкнутый путь коммивояжера имел кратчайшее расстояние?

### Условие задачи:
Генетический алгоритм для задачи коммивояжера.

**Для условий 3 варианта задания 12:**

1) Сгенерировать 2 особи (случайных решения) в виде перестановки номеров городов, которая всегда начинается с единицы.

2) Рассчитать фитнес-функцию для особей.

3) Закодировать их с применением альтернативной кодировки с пошаговыми комментариями.

4) Провести равномерное скрещивание особей с пошаговыми комментариями, получить два потомка.

5) Провести мутацию одного из потомков с пошаговыми комментариями.

6) Декодировать альтернативную кодировку потомков в натуральную кодировку с пошаговыми комментариями.

7) Рассчитать фитнес-функцию для потомков.

---

### Матрица расстояний:

|       | **A** | **B** | **C** | **D** | **E** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** | **∞** |   1   |   2   |   2   |   1   |
| **B** |   2   | **∞** |   3   |   4   |   4   |
| **C** |   1   |   5   | **∞** |   4   |   2   |
| **D** |   5   |   3   |   5   | **∞** |   3   |
| **E** |   4   |   4   |   1   |   2   | **∞** |


### Номера вершин:

- A - 1;
- B - 2;
- c - 3;
- D - 4;
- E - 5.

### Обновленная маирица растояний:

|       | **1** | **2** | **3** | **4** | **5** |
|-------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **1** | **∞** |   1   |   2   |   2   |   1   |
| **2** |   2   | **∞** |   3   |   4   |   4   |
| **3** |   1   |   5   | **∞** |   4   |   2   |
| **4** |   5   |   3   |   5   | **∞** |   3   |
| **5** |   4   |   4   |   1   |   2   | **∞** |

---

## Решение:

### Генерация особей:

Сгенерируем 2 особи, путем перестановки номеров городов, которые всегда начинаются с единицы.

- $x_1$ = 124351

- $x_2$ = 153241

### Фитнес-функция

Рассчитаем для особей фитнес-функцию, которая в контексте задачи о коммивояжере представляет собой длину маршрута.

- $F(x_1)$ = 1 + 4 + 5 + 2 + 4 = 16

- $F(x_2)$ = 1 + 1 + 5 + 4 + 5 = 16

---

### Альтернативная кодировка
#### Особь 1

Натуральный код особи $x_1$: 12345


| $x_1$                            |   |   |   |   |   |
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 2 | 4 | 3 | 5 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |

**Альтернативный код: 1**

| $x_1$                            |   |   |   |   |
|----------------------------------|---|---|---|---|
| натуральный код                  | 2 | 4 | 3 | 5 |
| возрастающая перестановка        | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 2 | 3 | 4 | 5 |

**Альтернативный код: 11**

| $x_1$                            |   |   |   |
|----------------------------------|---|---|---|
| натуральный код                  | 4 | 3 | 5 |
| возрастающая перестановка        | 3 | 4 | 5 |
| номера возрастающей перестановки | 3 | 4 | 5 |

**Альтернативный код: 112**

| $x_1$                            |   |   |
|----------------------------------|---|---|
| натуральный код                  | 3 | 5 |
| возрастающая перестановка        | 3 | 5 |
| номера возрастающей перестановки | 3 | 5 |

**Альтернативный код: 1121**
| $x_1$                            |   |
|----------------------------------|---|
| натуральный код                  | 5 |
| возрастающая перестановка        | 5 |
| номера возрастающей перестановки | 5 |

**Альтернативный код: 11211**

---

#### Особь 2
153241


| $x_1$                            |   |   |   |   |   |
|----------------------------------|---|---|---|---|---|
| натуральный код                  | 1 | 5 | 3 | 2 | 4 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |

**Альтернативный код: 1**

| $x_1$                            |   |   |   |   |
|----------------------------------|---|---|---|---|
| натуральный код                  | 5 | 3 | 2 | 4 |
| возрастающая перестановка        | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 2 | 3 | 4 | 5 |

**Альтернативный код: 14**

| $x_1$                            |   |   |   |
|----------------------------------|---|---|---|
| натуральный код                  | 3 | 2 | 4 |
| возрастающая перестановка        | 2 | 3 | 4 |
| номера возрастающей перестановки | 2 | 3 | 4 |

**Альтернативный код: 142**

| $x_1$                            |   |   |
|----------------------------------|---|---|
| натуральный код                  | 2 | 4 |
| возрастающая перестановка        | 2 | 4 |
| номера возрастающей перестановки | 2 | 4 |

**Альтернативный код: 1421**

| $x_1$                            |   |
|----------------------------------|---|
| натуральный код                  | 4 |
| возрастающая перестановка        | 4 |
| номера возрастающей перестановки | 4 |

**Альтернативный код: 14211**

---

### Равномерное скрещивание

- **Альтернативный код  $x_1$ : 11211**

- **Альтернативный код  $x_2$ : 14211**

Для проведения равномерного скрещивания сгенерируем случайную строку $z$ из нулей и единиц. 
Сформируем особь $x_3$ и $x_4$ по принципу: если i-ая позиция $z$ равна 0, то в $x_3$ пойдет i-ая позиция из $x_2$, а в $x_4$ - i-ая позиция из $x_1$, и наоборот при $z_i$ равной 1.  

| $z$                              | 0 | 1 | 0 | 1 | 0 |
|----------------------------------|---|---|---|---|---|
| $x_1$                            | 1 | 1 | 2 | 1 | 1 |
| $x_2$                            | 1 | 4 | 2 | 1 | 1 |
| $x_3$                            | 1 | 1 | 2 | 1 | 1 |
| $x_4$                            | 1 | 4 | 2 | 1 | 1 |

---

### Мутация

Проведем мутацию $x_4$. Для того чтобы мутировать i-ый разряд кодировки, выберем случайное число из диапазона от 1 до $(n-i+1)$. Для второго разряда диапазон будет от 1 до 4.
Для i = 2, 5 - 2 + 1 = 4
Диапозон от 1 до 4 => 3


 $x_3$ = 11211 -> 13211

---

### Восстановление натурального кода
#### Особь 3

- **Альтернативный код  $x_3$ : 13211**

| $x_3$                            |   |   |   |   |   |
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 3 | 2 | 1 | 1 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |

**натуральный код: 1**

| $x_3$                            |   |   |   |   |
|----------------------------------|---|---|---|---|
| альтернативный код               | 3 | 2 | 1 | 1 |
| возрастающая перестановка        | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 |

**натуральный код: 14**

| $x_3$                            |   |   |   |
|----------------------------------|---|---|---|
| альтернативный код               | 2 | 1 | 1 |
| возрастающая перестановка        | 2 | 3 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 |

**натуральный код: 143**

| $x_3$                            |   |   |
|----------------------------------|---|---|
| альтернативный код               | 1 | 1 |
| возрастающая перестановка        | 2 | 5 |
| номера возрастающей перестановки | 1 | 2 |

**натуральный код: 1432**

| $x_3$                            |   |
|----------------------------------|---|
| альтернативный код               | 1 |
| возрастающая перестановка        | 5 | 
| номера возрастающей перестановки | 1 |

**натуральный код: 14325**

---


#### Особь 4

- **Альтернативный код  $x_4$ : 14211**

| $x_3$                            |   |   |   |   |   |
|----------------------------------|---|---|---|---|---|
| альтернативный код               | 1 | 4 | 2 | 1 | 1 |
| возрастающая перестановка        | 1 | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 | 5 |

**натуральный код: 1**

| $x_3$                            |   |   |   |   |
|----------------------------------|---|---|---|---|
| альтернативный код               | 4 | 2 | 1 | 1 |
| возрастающая перестановка        | 2 | 3 | 4 | 5 |
| номера возрастающей перестановки | 1 | 2 | 3 | 4 |

**натуральный код: 15**

| $x_3$                            |   |   |   |
|----------------------------------|---|---|---|
| альтернативный код               | 2 | 1 | 1 |
| возрастающая перестановка        | 2 | 3 | 4 |
| номера возрастающей перестановки | 1 | 2 | 3 |

**натуральный код: 153**

| $x_3$                            |   |   |
|----------------------------------|---|---|
| альтернативный код               | 1 | 1 |
| возрастающая перестановка        | 2 | 4 |
| номера возрастающей перестановки | 1 | 2 |

**натуральный код: 1532**

| $x_3$                            |   |
|----------------------------------|---|
| альтернативный код               | 1 |
| возрастающая перестановка        | 4 | 
| номера возрастающей перестановки | 1 |

**натуральный код: 15324**

### Фитнес-функция для потомков

**натуральный код $x_3$: 14325**

**натуральный код $x_4$: 15324**

Рассчитаем для особей $x_3$ и $x_4$ фитнес-функцию:

- $F(x_3)$ = 2 + 5 + 5 + 4 + 4 = 20

- $F(x_4)$ = 1 + 1 + 5 + 4 + 5 = 16

