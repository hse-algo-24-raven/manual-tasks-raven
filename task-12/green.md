# Задание №12
# Задача коммивояжера (Traveling salesman problem). Метод ветвей и границ. Вариант 3


## Условия задачи

Матрица расстояний:

|       | **A** | **B** | **C** | **D** | **E** |
|:------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** | **∞** |   5   |   9   |   9   |   9   |
| **B** |   8   | **∞** |  10   |   5   |  11   |
| **C** |   9   |   5   | **∞** |  10   |   7   |
| **D** |  12   |   5   |  13   | **∞** |  10   |
| **E** |  12   |   5   |   8   |   7   | **∞** |

## Решение
### 1. Проведем редукцию строк матрицы

|       | **A** | **B** | **C** | **D** | **E** | Min |
|:------|:-----:|:-----:|:-----:|:-----:|:-----:|:---:|
| **A** | **∞** |   5   |   9   |   9   |   9   |  5  |
| **B** |   8   | **∞** |  10   |   5   |  11   |  5  |
| **C** |   9   |   5   | **∞** |  10   |   7   |  5  |
| **D** |  12   |   5   |  13   | **∞** |  10   |  5  |
| **E** |  12   |   5   |   8   |   7   | **∞** |  5  |
| Sum   |       |       |       |       |       | 25  |


Сумма констант редукции по строкам 25

Марица после редукции строк:

|       | **A** | **B** | **C** | **D** | **E** |
|:------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** | **∞** |   0   |   4   |   4   |   4   |
| **B** |   3   | **∞** |   5   |   0   |   6   |
| **C** |   4   |   0   | **∞** |   5   |   2   |
| **D** |   7   |   0   |   8   | **∞** |   5   |
| **E** |   7   |   0   |   3   |   2   | **∞** |

### 2. Проведем редукцию столбцов матрицы


|       | **A** | **B** | **C** | **D** | **E** | Sum |
|:------|:-----:|:-----:|:-----:|:-----:|:-----:|:---:|
| **A** | **∞** |   0   |   4   |   4   |   4   |     |
| **B** |   3   | **∞** |   5   |   0   |   6   |     |
| **C** |   4   |   0   | **∞** |   5   |   2   |     |
| **D** |   7   |   0   |   8   | **∞** |   5   |     |
| **E** |   7   |   0   |   3   |   2   | **∞** |     |
| Min   |   3   |   0   |   3   |   0   |   2   |  8  |


Сумма констант редукции по столбцам 8

Марица после редукции столбцов:

|       | **A** | **B** | **C** | **D** | **E** | 
|:------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** | **∞** |   0   |   1   |   4   |   2   | 
| **B** |   0   | **∞** |   2   |   0   |   4   | 
| **C** |   1   |   0   | **∞** |   5   |   0   | 
| **D** |   4   |   0   |   5   | **∞** |   3   | 
| **E** |   4   |   0   |   0   |   2   | **∞** | 

### 3. Оценка длины маршрута

Оценка длины маршрута снизу соответствует сумме констант редукции по строкам и по столбцам

25 + 8 = 33

### 4. Найдем решение задачи с использованием метода ветвей и границ

```mermaid
graph TB
    1(#1
    25+8=33)-->|+DB|3(#3
    21+2=36)
    1-->|-DB|2(#2
    33+3=36)
    3-->|-BA|4(#4
    36+3=39)
    3-->|+BA|5(#5
    36+0=36)
    5-->|-CE|6(#6
    36+4=40)
    5-->|+CE|7(#7
    36+0=36)
    7-->|-AC|8(#8
    36+∞=∞)
    7-->|+AC|9(#9
    36+0=36)
    9-->|+ED|10(#10
    36+0=36)
    
```

Чтобы определить ребро, по которому будет произведено ветвление из корневого узла рассчитаем штрафы для ребер с нулевой оценкой:

|        | **Штраф** |
|:-------|:---------:|
| **AB** |     1     |
| **BA** |     1     |
| **BD** |     2     |
| **CB** |     0     |
| **CE** |     2     |
| **DB** |     3     |
| **EB** |     0     |
| **EC** |     1     |

Максимальный штраф 3, выберем ребро DB, как одно из ребер с максимальным штрафом.

#### Узел №2
Узел №2 с исключением ребра DB имеет оценку 33 + 3 (штраф) = 36

#### Узел №3
Для получения оценки узла 3 необходимо рассчитать сумму констант редукции для матрицы с учетом включения ребра DB, для этого в матрице:
- удалим строку D,
- удалим столбец B,
- Заменим на бесконечность значение BD.

|       | **A** | **C** | **D** | **E** | Min   | 
|:------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **A** | **∞** |   1   |   4   |   2   |   1   | 
| **B** |   0   |   2   | **∞** |   4   |       | 
| **C** |   1   | **∞** |   5   |   0   |       | 
| **E** |   4   |   0   |   2   | **∞** |       |
| Min   |       |       |   2   |       |   3   |
### Редуция произведена по строкам и столбцу
Матрица после редукции:

|       | **A** | **C** | **D** | **E** | 
|:------|:-----:|:-----:|:-----:|:-----:|
| **A** | **∞** |   0   |   1   |   1   | 
| **B** |   0   |   2   | **∞** |   4   | 
| **C** |   1   | **∞** |   3   |   0   | 
| **E** |   4   |   0   |   0   | **∞** |

Сумма констант редукции 3

Оценка узла 3 = 33 + 3 (редукция) = 36

Продолжим поиск из узла 3

#### Выбор ребра
Чтобы определить ребро, по которому будет произведено ветвление из узла 3 рассчитаем штрафы для ребер с нулевой оценкой:

|        | **Штраф** |
|:-------|:---------:|
| **AC** |     1     |
| **BA** |     3     |
| **CE** |     2     |
| **EC** |     0     |
| **ED** |     1     |

Максимальный штраф 3, выберем ребро BA, как ребро с максимальным штрафом.

#### Узел №4
Узел №4 с исключением ребра BA имеет оценку 36 + 3 (штраф) = 39

#### Узел №5
Для получения оценки узла 5 необходимо рассчитать сумму констант редукции для матрицы с учетом включения ребра BA, для этого в матрице:
- удалим строку B,
- удалим столбец A,
- Заменим на бесконечность значение AB.

|       | **C** | **D** | **E** | 
|:------|:-----:|:-----:|:-----:|
| **A** |   0   |   1   |   1   | 
| **C** | **∞** |   3   |   0   | 
| **E** |   0   |   0   | **∞** |
Матрица после редукции:

|       | **C** | **D** | **E** | 
|:------|:-----:|:-----:|:-----:|
| **A** |   0   |   1   |   1   | 
| **C** | **∞** |   3   |   0   | 
| **E** |   0   |   0   | **∞** |

Сумма констант редукции 0

Оценка узла 5 = 36 + 0 (редукция) = 36

Продолжим поиск из узла 5

#### Выбор ребра
Чтобы определить ребро, по которому будет произведено ветвление из узла 3 рассчитаем штрафы для ребер с нулевой оценкой:

|        | **Штраф** |
|:-------|:---------:|
| **AC** |     1     |
| **CE** |     4     |
| **EC** |     0     |
| **ED** |     1     |

Максимальный штраф 4, выберем ребро CE, как ребро с максимальным штрафом.

#### Узел №6
Узел №6 с исключением ребра CE имеет оценку 36 + 4 (штраф) = 40

#### Узел №7
Для получения оценки узла 7 необходимо рассчитать сумму констант редукции для матрицы с учетом включения ребра CD, для этого в матрице:
- удалим строку C,
- удалим столбец E,
- Заменим на бесконечность значение EC.

|       | **C** | **D** |
|:------|:-----:|:-----:|
| **A** |   0   |   1   | 
| **E** | **∞** |   0   |

Матрица после редукции:

|       | **C** | **D** |
|:------|:-----:|:-----:|
| **A** |   0   |   1   | 
| **E** | **∞** |   0   |

Сумма констант редукции 0

Оценка узла 7 = 36 + 0 (редукция) = 36

Продолжим поиск из узла 7

#### Выбор ребра
Чтобы определить ребро, по которому будет произведено ветвление из узла 7 рассчитаем штрафы для ребер с нулевой оценкой:

|        | **Штраф** |
|:-------|:---------:|
| **AC** |     ∞     |
| **ED** |     ∞     |

Максимальный штраф будет бесконечно большим, выберем ребро AC

#### Узел №8
Узел №8 с исключением ребра AC имеет оценку 36 + ∞ (штраф) = ∞

#### Узел №9
Для получения оценки узла 9 необходимо рассчитать сумму констант редукции для матрицы с учетом включения ребра AC, для этого в матрице:
- удалим строку A,
- удалим столбец C.

|       | **D** |
|:------|:-----:|
| **E** |   0   |

Матрица после редукции:

|       | **D** |
|:------|:-----:|
| **E** |   0   |

Сумма констант редукции 0

Оценка узла 9 = 36 + 0 = 36

#### Выбор ребра
Альтернатив у ребра ED нет

#### Узел №10
Ребро ED включается в маршрут, длина которого составляет 36

### Ответ
- Кратчайший маршрут DBACED.
- Длина маршрута 36.