# Задача о рюкзаке (Knapsack problem). Генетический алгоритм. Вариант 8.

Решить задачу о рюкзаке с применением генетического алгоритма, с учетом следующих требований:
   - Придумать условия задачи с количеством предметов не менее 9.
   - Численность популяции не менее 4 особей, в скрещивании участвует половина популяции. 
   - Для скрещивания выбираются победители турнира, скрещивание – одноточечное.
   - До выполнения алгоритма сформулировать стратегию применения оператора мутации.
   - Сформировать не менее 3 поколений, не считая первоначального.

## Условие задачи

| Предметы  | A | B | C | D | E | F | G | H  | I |
|:----------|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:--:|:-:|
| Стоимость | 2 | 3 | 7 | 5 | 4 | 8 | 4 | 10 | 9 |
| Вес       | 1 | 3 | 9 | 7 | 8 | 3 | 4 | 5  | 6 |

Дано **_9_** предметов, для каждого указаны _стоимость_ и _вес_. В рюкзак можно поместить предметы, суммарно весящие **не более 25.**
В популяции _не менее 4 особей_, в скрещивании участвует _половина популяции_. Выбираются победители турнира, _одноточечное_ скрещивание.  

### Мутация применяется в следующих случаях:

- Если _два поколения подряд_ состав популяции _не изменялся_, выполняется **мутация у случайной особи**, чтобы избежать застоя в эволюции.
- Если _потомок идентичен_ существующей особи, выполняется **мутация случайного бита**, чтобы увеличить разнообразие.
- Если вес потомка _превышает 25_, **заменяется случайная 1 на 0**, чтобы снизить вес особи и сделать её жизнеспособной. Если после первой мутации вес всё ещё превышает 25, потомок **исключается** из популяции.
- Если особь _два поколения подряд была победителем_, применяется **мутация случайного бита**, чтобы предотвратить преждевременную стагнацию на одном решении.

## Решение

## _Первое поколение_
### Инициализация

Составляем таблицу решений (особей). В каждом решении _случайным образом_ выберем предмет, который берем, и отметим **_1_**, а который не берем **_0_**.
Помним, что согласно условию задачи в поколении должно быть _не менее 4_ особей (X1, X2, X3, X4).

|    | A | B | C | D | E | F | G | H | I |
|:---|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| X1 | 0 | 1 | 0 | 1 | 0 | 1 | 0 | 1 | 0 |
| X2 | 0 | 0 | 1 | 0 | 1 | 0 | 1 | 0 | 1 |
| X3 | 1 | 1 | 1 | 1 | 0 | 0 | 0 | 0 | 0 |
| X4 | 0 | 0 | 0 | 0 | 0 | 1 | 1 | 1 | 1 |

### Оценка

Считаем _фитнес-функцию_ каждой особи, т.е. суммируем **стоимость** выбранных предметов для каждого решения.  

* **X1** = B + D + F + H = 3 + 5 + 8 + 10 = **26**
* **X2** = C + E + G + I = 7 + 4 + 4 + 9 = **24**
* **X3** = A + B + C + D = 2 + 3 + 7 + 5 = **17**
* **X4** = F + G + H + I = 8 + 4 + 10 + 9 = **31**

### Отбор

Для скрещивания мы _выбираем 2_ (согласно условию) наиболее **"дорогих"** решения, т.к. задача заключается в поиске решения с максимальной стоимостью.  

* X1 = **26**
* X4 = **31**

### Скрещивание

_Одноточечное_ скрещивание (согласно условию) предполагает выполнение следующих шагов:
1. **Выбор точки разрыва.** В нашем случае возьмем точку между 4 и 5 предметом (битом).
2. Взять часть **до точки** разрыва от **одного родителя**, **после точки** разрыва - от **второго**. И наоборот.
3. **Совместить** части и получить потомков.

Разбиваем каждого родителя на две части.  
* X1 = _0101_ . _01010_
* X4 = **0000** . **01111**

Получаем потомков.
* X5 = _0101_**01111**
* X6 = **0000**_01010_

### Мутации

Т.к. это первое поколение, нам необходимо проверить только **идентичность** потомков существующим особям и их **вес**.
Потомки отличны от первоначальных решений. Однако **вес** особи **X5 превышает 25**.

* **X5** = B + D + F + G + H + I = 3 + 7 + 3 + 4 + 5 + 6 = **28**

В этом случае необходимо заменить любую **_1_** на **_0_** в решении, чтобы уменьшить его вес хотя бы до 25.
Таким образом убираем предмет G с весом 4, теперь **X5 = 010101011** и его вес равен **24**.

## _Второе поколение_
### Инициализация

К особям из первого поколения добавляем валидных потомков.

|    | A | B | C | D | E | F | G | H | I |
|:---|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| X1 | 0 | 1 | 0 | 1 | 0 | 1 | 0 | 1 | 0 |
| X2 | 0 | 0 | 1 | 0 | 1 | 0 | 1 | 0 | 1 |
| X3 | 1 | 1 | 1 | 1 | 0 | 0 | 0 | 0 | 0 |
| X4 | 0 | 0 | 0 | 0 | 0 | 1 | 1 | 1 | 1 |
| Х5 | 0 | 1 | 0 | 1 | 0 | 1 | 0 | 1 | 1 |
| Х6 | 0 | 0 | 0 | 0 | 0 | 1 | 0 | 1 | 0 |

### Оценка

Считаем _фитнес-функцию_ каждой особи. Оставляем 4 с наибольшей стоимостью.
* **X1 = 26**
* **X2 = 24**
* **X3 = 17** _- исключаем._
* **X4 = 31**
* **X5** = B + D + F + H + I = 3 + 5 + 8 + 10 + 9 = **35**
* **X6** = F + H = 8 + 10 = **18** _- исключаем._

### Отбор

Из оставшихся для скрещивания мы _выбираем 2_ наиболее **"дорогих"** решения.  

* X4 = **31**
* X5 = **35**

Особь Х4 второе поколение подряд стала победителем, значит есть место для **_мутации_** случайного бита.
Возьмем в это решение предмет А. Тогда **X4 = 100001111**, и его стоимость равна **33**.

### Скрещивание

Разбиваем каждого родителя на две части.
* X4 = **1000** . **01111**
* X5 = _0101_ . _01011_

Получаем потомков.
* X7 = **1000**_01011_
* X8 = _0101_**01111**

### Мутации

При повторной победе Х4 мы уже применили мутацию перед скрещиванием. 
Проверяем потомков на идентичность существующим особям и превышение веса ограничению в 25. 
Заметим, что у Х8 вес равен 28 (аналогично мутации Х5 в предыдущем поколении).

* **X8** = B + D + F + G + H + I = 3 + 7 + 3 + 4 + 5 + 6 = **28**

Необходимо заменить любую **_1_** на **_0_** в решении, чтобы сделать вес равным 25 или меньше.
Убираем предмет D с весом 7, теперь **X8 = 010001111** и его вес равен **21**.

## _Третье поколение_
### Инициализация

К особям из второго поколения добавляем валидных потомков.

|    | A | B | C | D | E | F | G | H | I |
|:---|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| X1 | 0 | 1 | 0 | 1 | 0 | 1 | 0 | 1 | 0 |
| X2 | 0 | 0 | 1 | 0 | 1 | 0 | 1 | 0 | 1 |
| X4 | 1 | 0 | 0 | 0 | 0 | 1 | 1 | 1 | 1 |
| Х5 | 0 | 1 | 0 | 1 | 0 | 1 | 0 | 1 | 1 |
| Х7 | 1 | 0 | 0 | 0 | 0 | 1 | 0 | 1 | 1 |
| Х8 | 0 | 1 | 0 | 0 | 0 | 1 | 1 | 1 | 1 |

### Оценка

Считаем _фитнес-функцию_ каждой особи. Оставляем 4 с наибольшей стоимостью.
* **X1 = 26** _- исключаем._
* **X2 = 24** _- исключаем._
* **X4 = 33**
* **X5 = 35**
* **X7** = A + F + H + I = 2 + 8 + 10 + 9 = **29**
* **X8** = B + F + G + H + I = 3 + 8 + 4 + 10 + 9 = **34**

### Отбор

Из оставшихся для скрещивания мы _выбираем 2_ наиболее **"дорогих"** решения.  

* X5 = **35**
* X8 = **34**

Особь Х5 второе поколение подряд стала победителем, значит есть место для **_мутации_** случайного бита.
Возьмем в это решение предмет A. Тогда **X5 = 110101011**, и его стоимость равна **37**.

### Скрещивание

Разбиваем каждого родителя на две части.
* X5 = _1101_ . _01011_
* X8 = **0100** . **01111**

Получаем потомков.
* X9 = _1101_**01111**
* X10 = **0100**_01011_

### Мутации

При повторной победе Х5 мы уже применили мутацию перед скрещиванием. 
Проверяем потомков на идентичность существующим особям и превышение веса ограничению в 25. 
Заметим, что у Х9 вес равен 29.

* **X9** = A + B + D + F + G + H + I = 1 + 3 + 7 + 3 + 4 + 5 + 6 = **29**

Необходимо заменить любую **_1_** на **_0_** в решении, чтобы сделать вес равным 25 или меньше.
Убираем предмет B с весом 3, теперь **X9 = 100101111** и его вес равен **26**. 
Второй раз мутацию не проводим, значит исключаем это решение.

## _Четвертое поколение_
### Инициализация

К особям из второго поколения добавляем валидных потомков.

|     | A | B | C | D | E | F | G | H | I |
|:----|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
| X4  | 1 | 0 | 0 | 0 | 0 | 1 | 1 | 1 | 1 |
| Х5  | 1 | 1 | 0 | 1 | 0 | 1 | 0 | 1 | 1 |
| Х7  | 1 | 0 | 0 | 0 | 0 | 1 | 0 | 1 | 1 |
| Х8  | 0 | 1 | 0 | 0 | 0 | 1 | 1 | 1 | 1 |
| Х10 | 0 | 1 | 0 | 0 | 0 | 1 | 0 | 1 | 1 |

### Оценка

Считаем _фитнес-функцию_ каждой особи. Оставляем одно решение с наибольшей стоимостью.
* **X4 = 33**
* **X5 = 37**
* **X7 = 29**
* **X8 = 34**
* **X10** = B + F + H + I = 3 + 8 + 10 + 9 = **30**

## Ответ

Лучшее решение из представленных **X5 = 110101011**.  
Его **стоимость** равна _37_, при этом оно **весит** _25_.  
При этом набор предметов такой: A, B, D, F, H, I.  
Свободного места в рюкзаке не осталось.