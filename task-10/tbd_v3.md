## Задача о максимальном потоке минимальной стоимости
## Вариант 3

Пропускная способность дуг сети и стоимость транспортировки указана в таблице:

| Дуги                      | sa | sb | sc | ba | bc | cd | ac | ad | dt |
|:--------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность    | 6  | 7  | 6  | 6  | 4  | 10 | 5  | 8  | 12 |
| Стоимость транспортировки | 1  | 1  | 3  | 1  | 1  | 1  | 3  | 4  | 1  |

### 1. Построим сеть с источником **s**, стоком **t** и указанными пропускными способностями дуг для поиска максимального потока.

```mermaid
graph LR
    s-->|6|a
    s-->|7|b
    s-->|6|c
    b-->|6|a
    b-->|4|c
    c-->|10|d
    a-->|5|c
    a-->|8|d
    d-->|12|t
```
Укажем начальный поток величиной 6 **s -6-> a -8-> d -12-> t**. Построим соответствующую остаточную сеть.

```mermaid
graph RL
    s-->|6|a
    b-.->|7|s
    c-.->|6|s
    a-.->|6|b
    c-.->|4|b
    d-.->|10|c
    c-.->|5|a
    a-->|6|d-.->|2|a
    d-->|6|t-.->|6|d
```

### 2. Проведем поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -6-> d -2-> a -6-> b -7-> s. Минимальный вес дуг на этом пути равен 2.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    s-->|6|a
    b-.->|5|s-->|2|b
    c-.->|6|s
    a-.->|4|b-->|2|a
    c-.->|4|b
    d-.->|10|c
    c-.->|5|a
    a-->|8|d
    d-->|8|t-.->|4|d
```

### 3. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -4-> d -10-> c -6-> s. Минимальный вес дуг на этом пути равен 4.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s-->|6|a
    b-.->|5|s-->|2|b
    c-.->|2|s-->|4|c
    a-.->|4|b-->|2|a
    c-.->|4|b
    d-.->|6|c-->|4|d
    c-.->|5|a
    a-->|8|d
    d-->|12|t
```

### 4. Продолжим поиск увеличивающего пути в остаточной сети

В остаточной сети не найдено увеличивающих путей, следовательно, алгоритм завершил работу и найденный поток величиной 12 является максимальным для данной сети.

```mermaid
graph LR
    s-->|6,6|a
    s-->|2,7|b
    s-->|4,6|c
    b-->|2,6|a
    b-->|0,4|c
    c-->|4,10|d
    a-->|0,5|c
    a-->|8,8|d
    d-->|12,12|t
```

### 5. Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | sa | sb | sc | ba | bc | cd | ac | ad | dt | Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:------:|
| Пропускная способность p(e)                   | 6  | 7  | 6  | 6  | 4  | 10 | 5  | 8  | 12 |        |
| Локальный поток f(e)                          | 6  | 2  | 4  | 2  | 0  | 4  | 0  | 8  | 12 |        |
| Стоимость транспортировки единицы потока c(e) | 1  | 1  | 3  | 1  | 1  | 1  | 3  | 4  | 1  |        |
| Суммарная стоимость f(e)*c(e)                 | 6  | 2  | 12 | 2  | 0  | 4  | 0  | 32 | 12 | **70** |

Стоимость полученного потока составляет 70. 

### 6. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph LR
    s-->|-1|a
    b-.->|1|s-->|-1|b
    c-.->|3|s-->|-3|c
    a-.->|1|b-->|-1|a
    c-.->|1|b
    d-.->|1|c-->|-1|d
    c-.->|3|a
    a-->|-4|d
    d-->|-1|t
```

В остаточной сети найден ориентированный цикл отрицательной стоимости s -> a -> d -> c -> s (- 1 - 4 + 1 + 3 = -1). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph LR
    s-->|6|a
    b-.->|5|s-->|2|b
    c-.->|2|s-->|4|c
    a-.->|4|b-->|2|a
    c-.->|4|b
    d-.->|6|c-->|4|d
    c-.->|5|a
    a-->|8|d
    d-->|12|t
```

Минимальный вес ребра в цикле 2 - это неиспользованный резерв ребра c -> s.

Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.

```mermaid
graph LR
    s-->|4|a-.->|2|s
    b-.->|5|s-->|2|b
    s-->|6|c
    a-.->|4|b-->|2|a
    c-.->|4|b
    d-.->|4|c-->|6|d
    c-.->|5|a
    a-->|6|d-.->|2|a
    d-->|12|t
```

### 7. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph LR
    s-->|-1|a-.->|1|s
    b-.->|1|s-->|-1|b
    s-->|-3|c
    a-.->|1|b-->|-1|a
    c-.->|1|b
    d-.->|1|c-->|-1|d
    c-.->|3|a
    a-->|-4|d-.->|4|a
    d-->|-1|t
```

В остаточной сети найден ориентированный цикл отрицательной стоимости s -> b -> a -> s (- 1 - 1 + 1 = -1). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph LR
    s-->|4|a-.->|2|s
    b-.->|5|s-->|2|b
    s-->|6|c
    a-.->|4|b-->|2|a
    c-.->|4|b
    d-.->|4|c-->|6|d
    c-.->|5|a
    a-->|6|d-.->|2|a
    d-->|12|t
```

Минимальный вес ребра в цикле 2.

Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.

```mermaid
graph LR
    s-->|6|a
    b-.->|7|s
    s-->|6|c
    a-.->|6|b
    c-.->|4|b
    d-.->|4|c-->|6|d
    c-.->|5|a
    a-->|6|d-.->|2|a
    d-->|12|t
```

### 8. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph LR
    s-->|-1|a
    b-.->|1|s
    s-->|-3|c
    a-.->|1|b
    c-.->|1|b
    d-.->|1|c-->|-1|d
    c-.->|3|a
    a-->|-4|d-.->|4|a
    d-->|-1|t
```

В остаточной сети найден ориентированный цикл отрицательной стоимости s -> a -> d -> c -> b -> s (- 1 - 4 + 1 + 1 + 1 = -2). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph LR
    s-->|6|a
    b-.->|7|s
    s-->|6|c
    a-.->|6|b
    c-.->|4|b
    d-.->|4|c-->|6|d
    c-.->|5|a
    a-->|6|d-.->|2|a
    d-->|12|t
```

Минимальный вес ребра в цикле 4.

Удалим найденный цикл - уменьшим на 4 вес всех ребер, входящих в цикл.

```mermaid
graph LR
    s-->|4|a-.->|2|s
    b-.->|3|s-->|4|b
    s-->|6|c
    a-.->|6|b
    b-->|4|c
    d-.->|6|c-->|4|d
    c-.->|5|a
    a-->|4|d-.->|4|a
    d-->|12|t
```
### 9. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph LR
    s-->|-1|a-.->|1|s
    b-.->|1|s-->|-1|b
    s-->|-3|c
    a-.->|1|b
    b-->|-1|c
    d-.->|1|c-->|-1|d
    c-.->|3|a
    a-->|-4|d-.->|4|a
    d-->|-1|t
```

В остаточной сети отсутствуют циклы отрицательной стоимости, следовательно, стоимость потока минимальна.

### 9. Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | sa | sb | sc | ba | bc | cd | ac | ad | dt | Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:------:|
| Пропускная способность p(e)                   | 6  | 7  | 6  | 6  | 4  | 10 | 5  | 8  | 12 |        |
| Локальный поток f(e)                          | 4  | 4  | 6  | 0  | 4  | 4  | 0  | 4  | 12 |        |
| Стоимость транспортировки единицы потока c(e) | 1  | 1  | 3  | 1  | 1  | 1  | 3  | 4  | 1  |        |
| Суммарная стоимость f(e)*c(e)                 | 4  | 4  | 18 | 0  | 4  | 4  | 0  | 16 | 12 | **62** |

Стоимость полученного потока составляет 62. 

### Ответ:
Максимальный поток в сети равен 12, минимальная стоимость потока 62, она реализуется следующим локальными потоками:

```mermaid
graph LR
    s-->|4,6|a
    s-->|4,7|b
    s-->|6,6|c
    b-->|0,6|a
    b-->|4,4|c
    c-->|4,10|d
    a-->|0,5|c
    a-->|4,8|d
    d-->|12,12|t
```
