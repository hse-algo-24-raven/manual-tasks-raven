# Задание №10
# Задача о максимальном потоке минимальной стоимости. Green, вариант 4

Пропускная способность дуг сети и стоимость транспортировки указана в таблице.
| Дуги                      | sa | sb | ac | ba | bc | bd | cd | at | dt |
|:--------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность    | 3  | 10 | 4  | 1  | 3  | 10 | 8  | 5  | 12 |
| Стоимость транспортировки | 1  | 1  | 1  | 2  | 3  | 5  | 1  | 3  | 1  |

### 1. Построим сеть с источником **s**, стоком **t** и указанными пропускными способностями дуг для поиска максимального потока.

```mermaid
graph LR
    s-->|3|a
    s-->|10|b
    a-->|4|c
    b-->|1|a
    b-->|3|c
    b-->|10|d
    c-->|8|d
    a-->|5|t
    d-->|12|t

```
Укажем начальный поток величиной 3 **s -> a -> t**. Построим соответствующую остаточную сеть.

```mermaid
graph RL
    t-.->|2|a-.->|1|b
    t-.->|12|d-.->|8|c-.->|3|b-.->|10|s
    d-.->|10|b
    c-.->|4|a
    s-->|3|a-->|3|t
```

### 2. Проведем поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> d -> b -> s. Минимальный вес дуг на этом пути равен 10.
Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    t-.->|2|a-.->|1|b
    t-.->|2|d-.->|8|c-.->|3|b
    s-->|10|b-->|10|d-->|10|t
    c-.->|4|a
    s-->|3|a-->|3|t
```

### 3. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети не найдено увеличивающих путей, следовательно, алгоритм завершил работу и найденный поток величиной 13 является максимальным для данной сети.

```mermaid
graph LR
    s-->|3, 3|a
    s-->|10, 10|b
    a-->|0, 4|c
    b-->|0, 1|a
    b-->|0, 3|c
    b-->|10, 10|d
    c-->|0, 8|d
    a-->|3, 5|t
    d-->|10, 12|t
```
### 4. Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | sa | sb | ac | ba | bc | bd | cd | at | dt |Итого|
|:--------------------------                    |:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность                        | 3  | 10 | 4  | 1  | 3  | 10 | 8  | 5  | 12 |
| Локальный поток f(e)                          | 3  | 10 | 0  | 0  | 0  | 10 | 0  | 3  | 10 |
| Стоимость транспортировки c(e)                | 1  | 1  | 1  | 2  | 3  | 5  | 1  | 3  | 1  |
| Суммарная стоимость f(e)*c(e)                 | 3  | 10 | 0  | 0  | 0  | 50 | 0  | 9  |10 |**82**|

Стоимость полученного потока составляет 82. 

### 5. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph RL
    t-.->|3|a-.->|2|b
    t-.->|1|d-.->|1|c-.->|3|b
    s-->|-1|b-->|-5|d-->|-1|t
    c-.->|1|a
    s-->|-1|a-->|-3|t
```
В остаточной сети найден ориентированный цикл отрицательной стоимости c -> a -> b -> d -> c (1 + 2 - 5 + 1 = -1). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph RL
    t-.->|2|a-.->|1|b
    t-.->|2|d-.->|8|c-.->|3|b
    s-->|10|b-->|10|d-->|10|t
    c-.->|4|a
    s-->|3|a-->|3|t
```

Минимальный вес ребра в цикле 1 - a -> b.

Удалим найденный цикл - уменьшим на 1 вес всех ребер, входящих в цикл.

```mermaid
graph RL
    t-.->|2|a
    t-.->|2|d-.->|7|c-.->|3|b
    s-->|10|b-->|9|d-->|10|t
    c-.->|3|a
    a-->|1|c
    s-->|3|a-->|3|t
    d-.->|1|b
    c-->|1|d
    b-->|1|a
```
### 6. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph RL
    t-.->|3|a
    t-.->|1|d-.->|1|c-.->|3|b
    s-->|-1|b-->|-5|d-->|-1|t
    c-.->|1|a
    a-->|-1|c
    s-->|-1|a-->|-3|t
    d-.->|5|b
    c-->|-1|d
    b-->|-2|a
```







В остаточной сети найден ориентированный цикл отрицательной стоимости d -> t -> a -> c -> b -> d (- 1 + 3 - 1 + 3 -5 = -1). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  



Минимальный вес ребра в цикле 2 - это неиспользованный резерв ребер s -> a и a -> d.
Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.

```mermaid
graph RL
    t-.->|1|a
    t-.->|3|d-.->|7|c-.->|2|b
    s-->|10|b-->|8|d-->|9|t
    c-.->|4|a
    s-->|3|a-->|4|t
    d-.->|2|b
    c-->|1|d
    b-->|1|a
    b-->|1|c
```











### 7. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph RL
    t-.->|3|a
    t-.->|1|d-.->|1|c-.->|3|b
    s-->|-1|b-->|-5|d-->|-1|t
    c-.->|1|a
    s-->|-1|a-->|-3|t
    d-.->|5|b
    c-->|-1|d
    b-->|-2|a
    b-->|-3|c
```

В остаточной сети найден ориентированный цикл отрицательной стоимости c -> b -> d -> c (3-5+1=-1). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph RL
    t-.->|1|a
    t-.->|3|d-.->|7|c-.->|2|b
    s-->|10|b-->|8|d-->|9|t
    c-.->|4|a
    s-->|3|a-->|4|t
    d-.->|2|b
    c-->|1|d
    b-->|1|a
    b-->|1|c
```


Минимальный вес ребра в цикле 2 - это неиспользованный резерв ребер b -> c.
Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.


```mermaid
graph RL
    t-.->|1|a
    t-.->|3|d-.->|5|c
    s-->|10|b-->|6|d-->|9|t
    c-.->|4|a
    s-->|3|a-->|4|t
    d-.->|4|b
    c-->|3|d
    b-->|1|a
    b-->|3|c
```

### 8. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.


```mermaid
graph RL
    t-.->|3|a
    t-.->|1|d-.->|1|c
    s-->|-1|b-->|-5|d-->|-1|t
    c-.->|1|a
    s-->|-1|a-->|-3|t
    d-.->|5|b
    c-->|-1|d
    b-->|-2|a
    b-->|-3|c
```

В остаточной сети отсутствуют циклы отрицательной стоимости, следовательно, стоимость потока минимальна.

### 9. Рассчитаем стоимость полученного максимального потока.

| Дуги                                        | sa | sb | ac | ba | bc | bd | cd | at | dt |Итого|
|:--------------------------                  |:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность                      | 3  | 10 | 4  | 1  | 3  | 10 | 8  | 5  | 12 |
| Локальный поток f(e)                        | 3  | 10 | 0  | 1  | 3  | 6  | 3  | 4  | 9  |
| Стоимость транспортировки c(e)              | 1  | 1  | 1  | 2  | 3  | 5  | 1  | 3  | 1  |
| Суммарная стоимость f(e)*c(e)               | 3  | 10 | 0  | 2  | 9  | 30 | 3  | 12 | 9  |**78**|
Стоимость полученного потока составляет 78. 

### Ответ:
Максимальный поток в сети равен 13, минимальная стоимость потока 78, она реализуется следующим локальными потоками:

```mermaid
graph LR
    s-->|3, 3|a
    s-->|10, 10|b
    a-->|0, 4|c
    b-->|1, 1|a
    b-->|3, 3|c
    b-->|6, 10|d
    c-->|3, 8|d
    a-->|4, 5|t
    d-->|9, 12|t
```