# Задание №11+
# Транспортная задача. Решение с использованием алгоритма поиска максимального потока минимальной стоимости.
# Вариант 3

## Постановка задачи
Два завода имеют производительность 6 и 9, а два складских помещения имеют вместимость 7 и 10. Матрица затрат на перевозку одной единицы товара (строки – это заводы, столбцы – это склады) имеет вид:

$$
 \begin{pmatrix}    
  3 & 5 \\ 
  1 & 4 \\ 
 \end{pmatrix}    
$$

Требуется:
1. Найти стоимость перевозки с первого завода на первый склад 6 единиц товара, а со второго завода на второй склад 7 единиц товара;
2. Используя алгоритм поиска максимального потока минимальной стоимости, скорректировать указанный выше вариант перевозки товаров, так чтобы объём перевозимых товаров не изменился, а стоимость их перевозки стала минимальной.

## Решение
### 1.
Производительность заводов:
- A = 6;
- B = 9.

Вместимость складов:
- I = 7;
- II = 10.

Построим полный двудольный граф и добавим вершину-источник *s* и вершину-сток *t*. Для каждого ребра укажем пары чисел *(f(e), p(e))*, где *f(e)* - локальный поток, *p(e)* - пропускная способность дуги. По условию задачи, локальный поток равен *13*: *6* единиц товара проходит по дуге (A, I) и *7* единиц - по дуге (B, II). 

```mermaid
graph LR
    s-->|"(6, 6)"|A
    s-->|"(7, 9)"|B
    A-->|"(6, 6)"|I
    A-->|"(0, 6)"|II
    B-->|"(0, 9)"|I
    B-->|"(7, 9)"|II
    I-->|"(6, 7)"|t
    II-->|"(7, 10)"|t
```

Возьмем затраты на транспортировку из матрицы и рассчитаем стоимость полученного потока.

| Дуги                          | sA | sB | AI | AII | BI | BII | It | IIt | Сумма  |
|:------------------------------|:--:|:--:|:--:|:---:|:--:|:---:|:--:|:---:|:------:|
| Пропускная способность    p(e)| 6  | 9  | 6  | 6   | 9  | 9   | 7  | 10  |        |
| Стоимость транспортировки c(e)| 0  | 0  | 3  | 5   | 1  | 4   | 0  | 0   |        |
| Локальный поток f(e)          | 6  | 7  | 6  | 0   | 0  | 7   | 6  | 7   |        |
| Суммарная стоимость f(e)*c(e) | 0  | 0  | 18 | 0   | 0  | 28  | 0  | 0   | **46** |

Стоимость полученного потока составляет *46*. 

### 2.
Используя алгоритм поиска максимального потока минимальной стоимости попытаемся уменьшить стоимость перевозки. 

Построим остаточную сеть с резервами.

```mermaid
graph LR
    s--->|6|A
    s--->|7|B
    B-.->|2|s
    A--->|6|I
    II-.->|6|A
    I-.->|9|B
    B--->|7|II
    II-.->|2|B
    I--->|6|t
    t-.->|1|I
    II-->|7|t
    t-.->|3|II
```

Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph LR
    s--->|0|A
    s--->|0|B
    B-.->|0|s
    A--->|-3|I
    II-.->|+5|A
    I-.->|+1|B
    B--->|-4|II
    II-.->|+4|B
    I--->|0|t
    t-.->|0|I
    II-->|0|t
    t-.->|0|II
```

В остаточной сети найден ориентированный цикл отрицательной стоимости *-3*. 

```mermaid
graph LR
   B--->|-4|II
   II-->|0|t
   t-.->|0|I
   I-.->|+1|B
```

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph LR
   B--->|7|II
   II-->|7|t
   t-.->|1|I
   I-.->|9|B
```
Минимальный вес ребра в цикле равен *1*. Удалим найденный цикл - уменьшим на 1 вес всех ребер, входящих в цикл.

Новая остаточная сеть имеет следующий вид:

```mermaid
graph LR
    s--->|6|A
    s--->|7|B
    B-.->|2|s
    A--->|6|I
    II-.->|6|A
    B--->|1|I
    I-.->|8|B
    B--->|6|II
    II-.->|3|B
    I--->|7|t
    II-->|6|t
    t-.->|4|II
```
### 3.
Проведем повторный поиск цикла отрицательной стоимости в остаточной сети. Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph LR
    s--->|0|A
    s--->|0|B
    B-.->|0|s
    A--->|-3|I
    II-.->|+5|A
    B--->|-1|I
    I-.->|+1|B
    B--->|-4|II
    II-.->|+4|B
    I--->|0|t
    II-->|0|t
    t-.->|0|II
```

В остаточной сети найден ориентированный цикл отрицательной стоимости *-2*. 

```mermaid
graph LR
    A--->|-3|I
    I-.->|+1|B
    B-.->|0|s
    s--->|0|A
```

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph LR
    A--->|6|I
    I-.->|8|B
    B-.->|2|s
    s--->|6|A
```

Минимальный вес ребра в цикле равен *2*. Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.

Новая остаточная сеть имеет следующий вид:

```mermaid
graph LR
    s--->|4|A
    A-.->|2|s
    s--->|9|B
    A--->|4|I
    I-.->|2|A
    II-.->|6|A
    B--->|3|I
    I-.->|6|B
    B--->|6|II
    II-.->|3|B
    I--->|7|t
    II-->|6|t
    t-.->|4|II
```
### 4.
Проведем повторный поиск цикла отрицательной стоимости в остаточной сети. Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph LR
    s--->|0|A
    A-.->|0|s
    s--->|0|B
    A--->|-3|I
    I-.->|+3|A
    II-.->|+5|A
    B--->|-1|I
    I-.->|+1|B
    B--->|-4|II
    II-.->|+4|B
    I--->|0|t
    II-->|0|t
    t-.->|0|II
```
В остаточной сети найден ориентированный цикл отрицательной стоимости *-1*. 

```mermaid
graph LR
    B--->|-4|II
    II-.->|+5|A
    A--->|-3|I
    I-.->|+1|B
```

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph LR
    B--->|6|II
    II-.->|6|A
    A--->|4|I
    I-.->|6|B
```

Минимальный вес ребра в цикле равен *4*. Удалим найденный цикл - уменьшим на 4 вес всех ребер, входящих в цикл.

Новая остаточная сеть имеет следующий вид:

```mermaid
graph LR
    s--->|4|A
    A-.->|2|s
    s--->|9|B
    I-.->|6|A
    A--->|4|II
    II-.->|2|A
    B--->|7|I
    I-.->|2|B
    B--->|2|II
    II-.->|7|B
    I--->|7|t
    II-->|6|t
    t-.->|4|II
```
### 5.
Проведем повторный поиск цикла отрицательной стоимости в остаточной сети. Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph LR
    s--->|0|A
    A-.->|0|s
    s--->|0|B
    I-.->|+3|A
    A--->|-5|II
    II-.->|+5|A
    B--->|-1|I
    I-.->|+1|B
    B--->|-4|II
    II-.->|+4|B
    I--->|0|t
    II-->|0|t
    t-.->|0|II
```
В остаточной сети отсутствуют циклы отрицательной стоимости, следовательно, стоимость потока минимальна.

### 6.
Рассчитаем стоимость полученного потока.

| Дуги                          | sA | sB | AI | AII | BI | BII | It | IIt | Сумма  |
|:------------------------------|:--:|:--:|:--:|:---:|:--:|:---:|:--:|:---:|:------:|
| Пропускная способность    p(e)| 6  | 9  | 6  | 6   | 9  | 9   | 7  | 10  |        |
| Стоимость транспортировки c(e)| 0  | 0  | 3  | 5   | 1  | 4   | 0  | 0   |        |
| Локальный поток f(e)          | 4  | 9  | 0  | 4   | 7  | 2   | 7  | 6   |        |
| Суммарная стоимость f(e)*c(e) | 0  | 0  | 0  | 20  | 7  | 8   | 0  | 0   | **35** |

Стоимость полученного потока составляет *35*. 

## Ответ:
Поток в сети равен *13*, минимальная стоимость потока *35*, она реализуется следующим локальными потоками:

```mermaid
graph LR
    s-->|"(4, 6)"|A
    s-->|"(9, 9)"|B
    A-->|"(0, 6)"|I
    A-->|"(4, 6)"|II
    B-->|"(7, 9)"|I
    B-->|"(2, 9)"|II
    I-->|"(7, 7)"|t
    II-->|"(6, 10)"|t
```